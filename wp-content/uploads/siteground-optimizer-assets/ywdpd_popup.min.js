jQuery(function(a){var b=a(document).find('.ywdpd_popup'),e={message:null,overlayCSS:{background:'#fff',opacity:.6},ignoreIfBlocked:!0},d={},c={},f={},h=function(b){for(var a=0,c=b.length;c>0;)a=(a<<5)-a+b.charCodeAt(--c)|0;return a},i,j,g,k,l;init_global_var=function(){b.find('.ywdpd_single_rule_container').each(function(){var b=a(this).attr('id'),e=a(this).data('allowed_items');d[b]||(d[b]=parseInt(e)),c[b]||(c[b]=[]),f[b]||(f[b]=[])})},get_allowed_item_by_rule=function(a){var b=0;return a=""+a,a.indexOf('ywdpd_single_rule_')===-1&&(a='ywdpd_single_rule_'+a),d[a]&&(b=d[a]),b},get_qty_added=function(e,b){var d=!1,c=0;return d=a(e).find('li.product.item .ywdpd_qty'),typeof b=='undefined'&&(b=''),d.each(function(){var e=a(this),d;(''==b||b!=e.attr('id'))&&(d=e.html(),d=''===d?0:parseInt(d),c=c+d)}),c},add_product_in_list=function(a,f,d,e){var b,g;return a=""+a,a.indexOf('ywdpd_single_rule_')===-1&&(a='ywdpd_single_rule_'+a),typeof d=='undefined'&&(d=''),typeof e=='undefined'&&(e={}),b=f+'_'+d+'_'+JSON.stringify(e),b=h(b),found_index_product_in_list(a,b)===-1&&(g={key:b,product_id:f,variation_id:d,variations:e,quantity:1},c[a].push(g)),b},remove_product_in_list=function(a,d){a=""+a,a.indexOf('ywdpd_single_rule_')===-1&&(a='ywdpd_single_rule_'+a);var b=found_index_product_in_list(a,d);b>=0&&c[a].splice(b,1)},increase_quantity_in_product_list=function(a,e){var b,d;a=""+a,a.indexOf('ywdpd_single_rule_')===-1&&(a='ywdpd_single_rule_'+a),b=found_index_product_in_list(a,e),b>=0&&(d=c[a][b],d.quantity=d.quantity+1,c[a][b]=d)},found_index_product_in_list=function(b,e){var d=-1,f;return b=""+b,b.indexOf('ywdpd_single_rule_')===-1&&(b='ywdpd_single_rule_'+b),c[b]&&(f=c[b],a.each(f,function(a,b){if(b.key==e)return d=a,!1})),d},decrease_quantity_in_product_list=function(a,e){var b,d;a=""+a,a.indexOf('ywdpd_single_rule_')===-1&&(a='ywdpd_single_rule_'+a),b=found_index_product_in_list(a,e),b>=0&&(d=c[a][b],d.quantity=d.quantity-1,c[a][b]=d)},show_confirm_button=function(c){var d=b.find('.ywdpd_single_rule_container').length,a=b.find('.ywdpd_btn_container');get_allowed_item_by_rule(c)>1||d>1?a.length&&a.show():a.find('a').click()},init_component=function(){init_qty_field(),b.on('click','.ywdpd_btn_container a',function(d){var b=a(this).parents('.ywdpd_step1');rule_to_apply=b.find('.ywdpd_single_rule_container'),count=0,tot_rule=rule_to_apply.length,a('.ywdpd_popup_stage').block(e),rule_to_apply.each(function(){count++,ajax_action=a(this).hasClass('gift_products')?ywdpd_popup_args.actions.add_gift_to_cart:ywdpd_popup_args.actions.add_special_to_cart,data={rules_to_apply:c,action:ajax_action},a.ajax({type:'POST',url:ywdpd_popup_args.ajax_url,data,dataType:'json',success:function(b){count==tot_rule&&setTimeout(function(){typeof b.fragments!='undefined'&&a(document.body).trigger('added_to_cart',[b.fragments,b.cart_hash])},1e3)},complete:function(){count==tot_rule&&(a('.ywdpd_popup_stage').unblock(),close_popup())}})})})},init_popup=function(){init_global_var(),init_slider(),init_component()},show_popup=function(){init_popup(),setTimeout(function(){b.fadeIn(300),center()},900)},close_popup=function(){b.fadeOut(300),b.hasClass('cart')&&a(document).trigger('wc_update_cart')},update_counter=function(c){var b=a(document).find('#ywdpd_single_rule_'+c),d=get_allowed_item_by_rule(c),e=get_qty_added(b);remain=d-e,remain==0?(b.find('.ywdpd_qty_increase.button').addClass('disabled'),b.find('.single_add_to_cart_button.button').addClass('disabled')):(b.find('.ywdpd_qty_increase.button').removeClass('disabled'),b.find('.single_add_to_cart_button.button').removeClass('disabled'))},init_slider=function(){var c=3,d=b.find('.ywdpd_popup_stage');d.each(function(){var h=a(this).find('.owl-carousel'),b=parseInt(h.find('li').size()),i=!0,e=30,f=!1,g=!0,b=b>c?c:b,d;b==1&&(e=0,f=!0,g=!1),d=a(this).find('ul.ywdpd_popup_items'),b>=3&&d.css({'padding-left':'5px'}),b==2&&d.css({'padding-left':'30px'}),h.owlCarousel({loop:!1,margin:e,center:f,autoWidth:i,nav:g,navText:['<span></span>','<span></span>'],responsiveClass:!0,onInitialized:function(a){var b=a.item.count;b>1&&d.find('.owl-stage').css({margin:'0 auto'})},responsive:{0:{items:1,autoWidth:!1,margin:10},721:{items:b},1000:{items:b}}})})},init_qty_field=function(){a(document).find('.ywdpd_qty_arrows, .single_add_to_cart_button').on('touchstart mousedown',function(a){a.stopImmediatePropagation()}),a(document).on('click','.ywdpd_qty_remove.button',function(c){c.preventDefault(),c.stopImmediatePropagation();var b=a(this).closest('.ywdpd_qty_input').find('.ywdpd_qty'),d=a(this).parents('.ywdpd_qty_fields_container').parent().find('.single_add_to_cart_button');rule_container=a(this).closest('.ywdpd_single_rule_container'),li=b.closest('li.product.item'),rule_id=li.data('ywdpd_rule_id'),key=b.attr('id'),remove_product_in_list(rule_id,key),d.hasClass('variable')?(b.parent().parent().remove(),a(this).parents('.ywdpd_qty_fields_container').find('.ywdpd_qty_field').length||li.removeClass('added')):(b.attr('id',''),b.html(''),b.parent().parent().hide(),li.removeClass('added'),d.show()),update_counter(rule_id)}),a(document).on('click','.ywdpd_qty_decrease.button',function(g){var b,f,d,e,h,i,j,c,k,l;g.preventDefault(),g.stopImmediatePropagation(),b=a(this).closest('.ywdpd_qty_input').find('.ywdpd_qty'),f=a(this).closest('.ywdpd_single_rule_container'),d=b.closest('li.product.item'),e=d.data('ywdpd_rule_id'),h=d.data('product_id'),i=1,j=parseInt(b.html()),c=j-1,c>=i&&(b.html(c),a(document).trigger('ywdpd_product_qty_decreased',[a(this),d,e,h,b])),c==1?(a(this).addClass('disabled').hide(),a(this).closest('.ywdpd_qty_input').find('.ywdpd_qty_remove').css({display:'inline-block'})):a(this).removeClass('disabled'),k=get_qty_added(f),l=get_allowed_item_by_rule(e),k<l&&(a('.ywdpd_qty_input .ywdpd_qty_increase').removeClass('disabled'),a(f).find('.single_add_to_cart_button').removeClass('disabled'))}),a(document).on('click','.ywdpd_qty_increase.button',function(e){e.preventDefault(),e.stopImmediatePropagation();var b=a(this).closest('.ywdpd_qty_input').find('.ywdpd_qty'),f=a(this).closest('.ywdpd_single_rule_container'),d=b.closest('li.product.item'),g=d.data('ywdpd_rule_id'),h=d.data('product_id'),i=parseInt(get_allowed_item_by_rule(g)),c=b.html(),c=''===c?0:parseInt(c);new_value=c+1,max=get_qty_added(f,b.attr('id')),max=i-max,new_value<=max&&(b.html(new_value),a(document).trigger('ywdpd_product_qty_increased',[a(this),d,g,h,b])),new_value==max?(a('.ywdpd_qty_input .ywdpd_qty_increase').addClass('disabled'),a(this).closest('.ywdpd_qty_input').find('.ywdpd_qty_decrease').removeClass('disabled'),a(f).find('.single_add_to_cart_button').addClass('disabled')):a('.ywdpd_qty_input .ywdpd_qty_increase').removeClass('disabled'),new_value>1&&(a(this).closest('.ywdpd_qty_input').find('.ywdpd_qty_decrease').css({display:'inline-block'}),a(this).closest('.ywdpd_qty_input').find('.ywdpd_qty_remove').hide())})},back_to_step1=function(){b.find('.ywdpd_step2').fadeOut(300,function(){b.find('.ywdpd_step1').fadeIn(300),b.find('.ywdpd_step2').html('')})},go_to_step2=function(c){b.find('.ywdpd_step1').fadeOut(300,function(){b.find('.ywdpd_step2').html(c),b.find('.ywdpd_step2 .variations_form').each(function(){a(this).wc_variation_form()}),i(),j(),add_variable_gift(),b.find('.ywdpd_step2').fadeIn(300),a(document).trigger('ywdpd_step2_initialized')})},center=function(){var e=b.find('.ywdpd_popup_wrapper'),g=e.find('.ywdpd_single_rule_container'),h=715,c=e.css('width'),f=0,d=e.outerHeight(),i=a('.ywdpd_popup').width(),j=a('.ywdpd_popup').height(),k=a(window).width();k>720?g.each(function(){var b=a(this).find('ul li'),d=b.length;if(d>=3){c=h;return}c=438}):(c=c.replace('px',''),c=parseFloat(c),d=parseFloat(d)-10,a('#wpadminbar').length&&(d=d-a('#wpadminbar').height())),f=c,e.css({position:'fixed',top:(j-d)/2+"px",left:(i-f)/2+"px"})},show_qty_field=function(b){a(b).find('.single_add_to_cart_button.button').hide(),a(b).find('.ywdpd_qty_field').show()},b.on('click','.ywdpd_close',close_popup),b.on('click','.ywdpd_step1 ul.ywdpd_popup_items li.product .single_add_to_cart_button',function(j){var b,d,c,i,g,f,h;j.preventDefault(),b=a(this).closest('li.product.item'),d=b.data('product_id'),c=b.data('ywdpd_rule_id'),i=b.data('product_type'),g=get_allowed_item_by_rule(c),a(this).hasClass('variable')?(f=a(this).data('ywdpd_action'),h={product_id:d,rule_id:c,action:ywdpd_popup_args.actions.show_second_step,rule_type:f},a.ajax({type:'POST',url:ywdpd_popup_args.ajax_url,data:h,dataType:'json',beforeSend:function(){b.parents('.ywdpd_single_rule_container').block(e)},success:function(a){a.template!==''&&go_to_step2(a.template)},complete:function(){b.parents('.ywdpd_single_rule_container').unblock()}})):a(document).trigger('ywdpd_first_product_added',[b,c,d,g])}),i=function(){a('.variations_form.cart').on('found_variation',function(n,c){var d=a(this),f=a(this).parent().find('.ywdpd_rule_id').val(),g=a('#ywdpd_single_rule_'+f),h=a('input[name="product_id"]').val(),b=g.find("li.item[data-product_id='"+h+"']"),i=a('input.ywdpd_rule_type').val(),j=b.data('discount_type'),k=b.data('discount_amount'),l=b.data('total_to_add'),m={ywdp_check_rule_id:f,product_id:c.variation_id,rule_type:i,type_discount:j,amount_discount:k,tot_to_add:l,action:ywdpd_popup_args.actions.check_variable};a.ajax({type:'POST',url:ywdpd_popup_args.ajax_url,data:m,dataType:'json',beforeSend:function(){d.block(e)},success:function(b){b.variation_found?a('.ywdpd_add_to_gift').addClass('disabled'):c.is_in_stock?(a('.ywdpd_add_to_gift').removeClass('disabled'),a('.ywdpdp_single_product p.stock.out-of-stock').remove()):(a('.ywdpdp_single_product .variations_form.cart').append(c.availability_html),a('.ywdpd_add_to_gift').addClass('disabled')),a('.ywdpd_step2 .price').html(b.price),a('.ywdpd_step2 .price').show()},complete:function(){d.unblock()}})}).on('reset_data',function(b){a('.ywdpd_add_to_gift').addClass('disabled'),a('.ywdpdp_single_product p.stock.out-of-stock').remove(),a('.ywdpd_step2 .price').hide()}),a('.ywdpd_step2').on('select2:open',function(b){a('.select2-container').addClass('ywcdd_select2')}),a('.ywdpd_step2').on('select2:closing',function(b){a('.select2-container').removeClass('ywcdd_select2')})},j=function(){var b=a('.ywdpd_step2 .ywdpdp_single_product');b.length&&b.hasClass('variation')&&(b.find('select').select2(),b.on('click','.reset_variations',function(a){b.find('select').val('').trigger('change')}),g(b),b.on('change','select',function(a){g(b)}))},g=function(b){var c=b.find('.ywdpd_add_to_gift'),d=!0;c.addClass('disabled'),b.find('select').each(function(){if(''===a(this).val()){d=!1;return}}),d&&c.removeClass('disabled')},k=function(c){var d=c.closest('.ywdpd_single_product_right'),e=d.find('[name^="attribute"]'),b={};return e.each(function(){var c=a(this),d=c.attr('name');b[d]=c.val()}),b},l=function(d,e){var b='',c=e.closest('.ywdpd_single_product_right');return a.each(d,function(a,d){let e=c.find('[name ="'+a+'"]'),f=c.find('label[for="'+e.attr('id')+'"]');b+='<div class="ywdpd_single_attribute">',b+="<span class='attribute_name'>"+f.html()+':</span>',b+="<span class='attribute_value'>"+d+'</span>',b+='</div>'}),b},add_variable_gift=function(){a(document).on('click','.ywdpd_add_to_gift',function(i){var h,e,f,d,g,b,c,j;i.preventDefault(),i.stopImmediatePropagation(),h=a('input[name="product_id"]').val(),e=a('input.variation_id').val(),f=k(a(this)),d='',rule_id=a('input.ywdpd_rule_id').val(),d=a(document).find('#ywdpd_single_rule_'+rule_id),li='',a(this).parent().parent().parent().hasClass('variation')?li=d.find('ul.ywdpd_popup_items li[data-product_id="'+e+'"]'):li=d.find('ul.ywdpd_popup_items li[data-product_id="'+h+'"]'),g=add_product_in_list(rule_id,h,e,f),qty_field=li.find("#"+g+'.ywdpd_qty'),qty_field.length?qty_field.parent().find('.ywdpd_qty_increase.button').click():(b='<div class="ywdpd_qty_field">',b+='<div class="ywdpd_qty_input">',b+='<span class="ywdpd_qty_label">'+ywdpd_popup_args.i18n_qty_field_label+'</span>',b+='<div class="ywdpd_attribute_fields"></div>',b+='<span class="ywdpd_qty"></span>',b+='<span class="ywdpd_qty_arrows">',b+='<span class="ywdpd_qty_remove button"><span></span></span>',b+='<span class="ywdpd_qty_decrease button"><span></span></span>',b+='<span class="ywdpd_qty_increase button"><span></span></span>',b+='</span>',b+='</div>',b+='</div>',c=a(b),j=l(f,a(this)),c.find('.ywdpd_qty').attr('id',g),c.find('.ywdpd_qty').html(1),c.find('.ywdpd_attribute_fields').html(j),c.appendTo(li.find('.ywdpd_qty_fields_container')).show(),li.addClass('added'),init_qty_field()),show_confirm_button(rule_id),update_counter(rule_id),back_to_step1()})},a(document).on('click','.ywdpd_back',function(a){back_to_step1()}),a(document).on('click','.ywdpd_footer a',function(a){a.preventDefault(),close_popup()}),a(document).on('keyup',function(a){a.keyCode==27&&close_popup()}),a(document).on('ywdpd_first_product_added',function(i,c,d,f,g){var h=add_product_in_list(d,f),e=b.find('.ywdpd_single_rule_container').length;c.find('.ywdpd_qty').attr('id',h),c.find('.ywdpd_qty').html(1),update_counter(d),c.addClass('added'),g>1||e>1?(show_qty_field(c),show_confirm_button(d)):a('.ywdpd_btn_container a').click()}),a(document).on('ywdpd_product_qty_increased',function(c,d,e,a,f,b){increase_quantity_in_product_list(a,b.attr('id')),update_counter(a)}),a(document).on('ywdpd_product_qty_decreased',function(c,d,e,a,f,b){decrease_quantity_in_product_list(a,b.attr('id')),update_counter(a)}),b.length&&(a(window).on('resize',function(){center()}),show_popup())})