jQuery(function(a){a.fn.yith_bundle_form=function(){a(this).each(function(){var b=a(this),o=b.data('product-id'),t=b.data('per-item-pricing'),s=b.data('ajax-update-price'),l=b.find('.yith-wcpb-product-bundled-items .price'),j=b.closest(yith_wcpb_params.price_handler_parent).find(yith_wcpb_params.price_handler)||b.closest(yith_wcpb_params.price_handler_parent_alt).find(yith_wcpb_params.price_handler_alt),c=yith_wcpb_params.price_handler_only_first==1?j.not(l).first():j.not(l),h=b.closest('form').find('button[type=submit]'),e=b.closest('.product').find('.add-request-quote-button'),d=b.find('.bundled_item_cart_content'),f=b.find('input.yith-wcpb-bundled-quantity'),i=b.find('.yith-wcpb-bundled-optional'),n=b.find('.variation_id'),k=b.find('input[name=yith_wcpb_wpml_client_currency]'),g=null,p=function(){var b=!1,g=!1,i=!1,c='disabled',j=['disabled','yith-wcpb-variation-selection-needed','yith-wcpb-out-of-stock-item-selected'].join(' '),k;d.each(function(){var c=a(this),e=c.closest('.yith-wcpb-product-bundled-item'),f=e.find('.yith-wcpb-bundled-optional').first(),h=e.find('.yith-wcpb-bundled-quantity').first(),j=c.find('select.yith-wcpb-select-for-variables'),d=f.length,k=d&&f.is(':checked'),l=h.length&&parseInt(h.val())===0;(!d||k)&&!l?(j.each(function(){a(this).val()||(b=!0,g=!0)}),c.find('.variations').slideDown('fast'),c.find('.single_variation_wrap').slideDown('fast'),c.find('.out-of-stock').length&&(b=!0,i=!0)):d&&(c.find('.quantity input.qty').removeAttr('max'),c.find('.single_variation_wrap').slideUp('fast'),c.find('.variations').slideUp('fast'))}),g&&(c+=' yith-wcpb-variation-selection-needed'),i&&(c+=' yith-wcpb-out-of-stock-item-selected'),k=f.filter(function(){return!this.checkValidity()}),k.length&&(b=!0),b?h.addClass(c):h.removeClass(j),e.length&&(b?e.addClass(c):e.removeClass(j))},q={message:null,overlayCSS:{background:'#fff',opacity:.6},ignoreIfBlocked:!0},r=function(){var b,d,e,h,j;if(g&&g.abort(),s!=1)return;c.block(q),b=[],d=[],e=[],f.each(function(){b[a(this).data('item-id')-1]=a(this).val()}),i.each(function(){d[a(this).data('item-id')-1]=a(this).is(':checked')?1:0}),n.each(function(){e[a(this).data('item-id')-1]=a(this).val()}),h=k.length>0?k.val():'',j={bundle_id:o,array_qty:b,array_opt:d,array_var:e,yith_wcpb_wpml_client_currency:h,action:'yith_wcpb_get_bundle_total_price'},g=a.ajax({type:'POST',data:j,url:ajax_obj.ajaxurl,success:function(d){var b=c.find('ins .amount');b.length<1&&(b=c.find('.amount')),b.length<1&&(b=c),b=b.first(),b.html(d.price_html),c.html(d.price_html),a(document).trigger('yith_wcpb_ajax_update_price_request',d),c.unblock()}})},m=function(b){a(this).is('.disabled')&&(b.preventDefault(),a(this).is('.yith-wcpb-out-of-stock-item-selected')?window.alert(yith_wcpb_params.i18n.out_of_stock_item_selected):a(this).is('.yith-wcpb-variation-selection-needed')&&window.alert(yith_wcpb_params.i18n.variation_selection_needed))};h.on('click',m),e.on('click',m),b.on('yith_wcpb_update_price',function(){p(),r()}),yith_wcpb_params.update_price_on_load==='yes'&&b.trigger('yith_wcpb_update_price'),f.on('change',function(){a(this).parents('.bundled_item_cart_content').length||b.trigger('yith_wcpb_update_price')}),i.on('click',function(){a(this).parents('.bundled_item_cart_content').length||b.trigger('yith_wcpb_update_price')}),d.on('change',function(){b.trigger('yith_wcpb_update_price')}),d.on('found_variation',function(l,b){var c=a(this).closest('.product'),h=c.find('.yith-wcpb-product-bundled-item-data__price .price').first(),i=h.find('ins'),j=h.find('del'),d=c.find('.yith-wcpb-product-bundled-item-image img').first(),g=c.data('min-quantity'),f=c.data('max-quantity'),e=c.find('.yith-wcpb-bundled-quantity'),k;typeof b.max_qty!='undefined'&&b.max_qty&&(f=Math.min(f,b.max_qty)),e.length&&(e.attr('min',g),c.find('.yith-wcpb-bundled-quantity__invalid-notice__min-qty').html(g),e.attr('max',f),c.find('.yith-wcpb-bundled-quantity__invalid-notice__max-qty').html(f),k=Math.min(Math.max(e.val(),g),f),e.val(k)),typeof b.image!='undefined'&&(typeof b.image.srcset!='undefined'&&b.image.srcset?d.attr('srcset',b.image.srcset):typeof b.image.thumb_src!='undefined'&&b.image.thumb_src&&(d.removeAttr('srcset'),d.attr('src',b.image.thumb_src)),typeof b.image.full_src!='undefined'&&typeof b.image.full_src_h!='undefined'&&typeof b.image.full_src_w!='undefined'&&(d.attr('data-large_image',b.image.full_src),d.attr('data-large_image_width',b.image.full_src_w),d.attr('data-large_image_height',b.image.full_src_h))),i.html(b.price_html.replace('price','amount')),j.html(b.display_regular_price_html),a(document).trigger('yith_wcpb_found_variation_after',[a(this),b])}).on('reset_data',function(){var d=a(this).closest('.product'),b=d.find('.yith-wcpb-product-bundled-item-data__price .price').first(),f=b.find('ins'),g=b.data('default-ins'),h=b.find('del'),i=b.data('default-del'),e=d.find('.yith-wcpb-product-bundled-item-image img').first(),c=e.attr('src');'undefined'!=typeof c&&c.length>0&&e.attr('srcset',c),f.html(g),h.html(i)}),d.trigger('check_variations'),d.trigger('update_variation_values')})},a(document).on('yith_wcpb_add_to_cart_init',function(){a('.yith-wcpb-bundle-form').yith_bundle_form()}).trigger('yith_wcpb_add_to_cart_init'),a(document).on('qv_loader_stop',function(){a(document).trigger('yith_wcpb_add_to_cart_init')}),a(document).on('mfpOpen',function(){a('.variations_form').each(function(){a(this).wc_variation_form()}),a(document).trigger('yith_wcpb_add_to_cart_init')});var b={enabled:typeof PhotoSwipe!='undefined'&&typeof PhotoSwipeUI_Default!='undefined'&&typeof wc_single_product_params!='undefined'&&'yes'===yith_wcpb_params.photoswipe_enabled,init:function(){a(document).on('click','.yith-wcpb-product-bundled-item-image .woocommerce-product-gallery__image a',this.openPhotoswipe),this.indexGallery()},getImages:function(){return a('.yith-wcpb-product-bundled-item-image .woocommerce-product-gallery__image')},indexGallery:function(){var c=this.getImages(),b=0;c.each(function(){a(this).data('bundled-image-index',b),b++})},getGalleryItems:function(){var b=this.getImages(),c=[];return b.length>0&&b.each(function(i,e){var b=a(e).find('img'),f,g,h,d;b.length&&(f=b.attr('data-large_image'),g=b.attr('data-large_image_width'),h=b.attr('data-large_image_height'),d={src:f,w:g,h,title:b.attr('data-caption')?b.attr('data-caption'):b.attr('title')},c.push(d))}),c},openPhotoswipe:function(c){var d,e,f,g,h,i;if(c.preventDefault(),!b.enabled)return;d=a('.pswp')[0],e=b.getGalleryItems(),f=a(c.target),g=f.closest('.woocommerce-product-gallery__image'),h=a.extend({index:a(g).data('bundled-image-index')},wc_single_product_params.photoswipe_options),i=new PhotoSwipe(d,PhotoSwipeUI_Default,e,h),i.init()}};b.init()})