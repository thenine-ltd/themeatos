jQuery(function(l){l(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:0}),l(".tips-top").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:0,defaultPosition:"top"}),l(".yith-wcmbs-tabs").tabs(),l(".yith-wcmbs-select2").select2(),l(".yith-wcmbs-color-picker").wpColorPicker(),l(".yith-wcmbs-date").datepicker({dateFormat:"yy-mm-dd"});var c={dom:{container:l(".yith-wcmbs-admin-plans-delay").first(),plansList:l("#_yith_wcmbs_restrict_access_plan")},template:wp.template("yith-wcmbs-admin-single-plan-delay"),init:function(){this.dom.container.length&&(this.dom.plansList.on("change",this.plansListChangeHandler).trigger("change"),this.dom.container.on("change",".yith-plugin-fw-radio",this.radioChangeHandler))},plansListChangeHandler:function(){var t,i=l(this),e=c._getRows(),n=i.val(),a=[];for(t in e.each(function(){var t=l(this).data("plan-id")+"";a.push(t),(!n||n.indexOf(t)<0)&&l(this).remove()}),n){var o,s=n[t];(!a.length||a.indexOf(s)<0)&&(o=i.find('option[value="'+s+'"]').html(),(o=l(c.template({planID:s,planName:o}))).find("input[type=radio]").each(function(){var t="_yith_wcmbs_single_plan_delay_"+s+"-"+l(this).val();l(this).attr("id",t),l(this).parent().find("label").attr("for",t)}),c.dom.container.append(o))}},radioChangeHandler:function(){var t=l(this).parent().find(".yith-wcmbs-single-plan-delay-field");"delay"===l(this).val()?t.removeAttr("disabled"):t.attr("disabled","disabled")},_getRows:function(){return c.dom.container.find(".yith-wcmbs-single-plan-delay-row")}},e=(c.init(),l("#yith-wcmbs-plan-item-order-container")),t=e.find("li").get(),i=l("#yith-wcmbs-plan-item-text"),n={message:null,overlayCSS:{background:"#000",opacity:.6},ignoreIfBlocked:!0},a=(t.sort(function(t,i){t=parseInt(l(t).attr("rel")),i=parseInt(l(i).attr("rel"));return t<i?-1:i<t?1:0}),l(t).each(function(t,i){e.append(i)}),e.sortable({items:"li",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.8,revert:!0,stop:function(t,i){i.item.hasClass("yith-wcmbs-plan-item-text")&&i.item.find("input").focus()}}),i.draggable({connectToSortable:"#yith-wcmbs-plan-item-order-container",helper:"clone",revert:"invalid",stop:function(t,i){i.helper.html('<input type="text" name="_yith_wcmbs_plan_items[]" /><span class="dashicons dashicons-no-alt close"></span>'),i.helper.css({height:"auto"})}}),e.on("click",".close",function(t){l(t.target).closest("li").remove()}),e.find("li").disableSelection(),i.disableSelection(),e.on("click",".yith-wcmbs-delete-from-plan",function(t){var t=l(t.target),i=t.closest("li"),e=t.data("post-id"),t=t.data("plan-id");i.block(n),l.ajax({url:ajaxurl,type:"POST",data:{action:"yith_wcmbs_remove_plan_for_post",post_id:e,plan_id:t},success:function(t){console.log(t),i.unblock(),i.remove()}})}),e.on("click",".yith-wcmbs-hide-show-item",function(t){var t=l(t.target),i=t.closest("li").children("input.yith_wcmbs_hidden_item_ids"),e=(t.data("post-id"),"show");"show"==(e=t.is(".dashicons-visibility")?"hide":e)?(i.prop("disabled",!0),t.removeClass("dashicons-hidden").addClass("dashicons-visibility")):(i.prop("disabled",!1),t.removeClass("dashicons-visibility").addClass("dashicons-hidden"))}),l("#bulk_edit").on("click",function(){var t=l("#bulk-edit"),i=[],t=(t.find("#bulk-titles").children().each(function(){i.push(l(this).attr("id").replace(/^(ttle)/i,""))}),l(".plans-checklist",t).find("input:checked")),e=[];t.each(function(){e.push(l(this).val())}),l.ajax({url:ajaxurl,type:"POST","async":!1,cache:!1,data:{action:"yith_wcmbs_save_bulk_edit",post_ids:i,yith_wcmbs_restrict_access_plan:e}})}),l(document).on("yith_wcmbs_select2_init",function(){var t=l(".yith_wcmbs_ajax_select2_select_customer");t.each(function(){var t={allowClear:!!l(this).data("allow_clear"),placeholder:l(this).data("placeholder"),minimumInputLength:l(this).data("minimum_input_length")?l(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:ajaxurl,dataType:"json",quietMillis:250,data:function(t){return{term:t.term,action:"woocommerce_json_search_customers",security:yith_wcmbs_admin.customer_nonce}},processResults:function(t){var e=[];return t&&l.each(t,function(t,i){e.push({id:t,text:i})}),{results:e}},cache:!0}};l(this).select2(t)}),t.on("yith_wcmbs_select2_reset",function(){l(this).val("").trigger("change")}).trigger("yith_wcmbs_select2_reset")}).trigger("yith_wcmbs_select2_init"),l(".yith-wcmbs-select2-select-all").on("click",function(t){t=l(t.target).data("container-id"),t=l("#"+t).find(".yith-wcmbs-select2").first();t.find("option").prop("selected",!0),t.trigger("change")}),l(".yith-wcmbs-select2-deselect-all").on("click",function(t){t=l(t.target).data("container-id"),t=l("#"+t).find(".yith-wcmbs-select2").first();t.find("option:selected").removeAttr("selected"),t.trigger("change")}),l(document).on("click",".yith-wcmbs-copy-to-clipboard",function(t){var i,e=l(this).data("selector-to-copy"),e=l(e);0<e.length&&(i=l("<input>"),l("body").append(i),i.val(e.html()).select(),document.execCommand("copy"),i.remove())}),{target:".yith-wcmbs-show-conditional:not(.yith-wcmbs-show-conditional--initialized)",initEvent:"yith-wcmbs-show-conditional-init",init:function(){l(a.target).hide().each(function(){var n,a,o,t=l(this),i=t.data("dep-selector"),s=l(i),i=t.data("dep-value");s.length&&(a=i.split(","),s.on("change keyup",function(){var e=!0;s.each(function(t){var i=l(this);o=a[t],(n=i.is("input[type=checkbox]"))&&(o="no"!==o),(n?i.is(":checked"):i.val())!==o&&(e=!1)}),e?t.show():t.hide()}).trigger("change"),t.addClass("yith-wcmbs-show-conditional--initialized"))})}}),o=(l(document).on(a.initEvent,a.init),a.init(),{dom:{hideContents:l("#yith-wcmbs-hide-contents"),alternativeContentMode:l("#yith-wcmbs-default-alternative-content-mode"),alternativeContentContainer:l("#yith-wcmbs-default-alternative-content").closest(".yith-plugin-fw-panel-wc-row"),alternativeContentIDContainer:l("#yith-wcmbs-default-alternative-content-id").closest(".yith-plugin-fw-panel-wc-row")},init:function(){var t=o;t.dom.hideContents.on("change",t.handleAlternativeContentVisibility),t.dom.alternativeContentMode.on("change",t.handleAlternativeContentVisibility),t.handleAlternativeContentVisibility()},handleAlternativeContentVisibility:function(){var t=o,i=!1,e=!1;"alternative_content"===t.dom.hideContents.val()&&("set"===t.dom.alternativeContentMode.val()?i=!0:e=!0),i?t.dom.alternativeContentContainer.show():t.dom.alternativeContentContainer.hide(),e?t.dom.alternativeContentIDContainer.show():t.dom.alternativeContentIDContainer.hide()}}),s={init:function(){l(document).on("scroll",s.handleFloatingButtonVisisbility)},handleFloatingButtonVisisbility:function(){var t;0<l("input.yith-wcmbs-save-plan-button").length&&(t=0<l("input.yith-wcmbs-save-plan-button")[0].getBoundingClientRect().y-window.innerHeight)!==s.handleFloatingButtonVisisbility?.buttonVisibility&&(l("#yith-wcmbs-save-plan-floating-button").toggleClass("visible",t),s.handleFloatingButtonVisisbility.buttonVisibility=t)}};o.init(),s.init()});