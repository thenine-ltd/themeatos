jQuery(function(y){y.fn.yith_bundle_form=function(){y(this).each(function(){var t=y(this),r=t.data("product-id"),d=(t.data("per-item-pricing"),t.data("ajax-update-price")),i=t.find(".yith-wcpb-product-bundled-items .price"),e=t.closest(yith_wcpb_params.price_handler_parent).find(yith_wcpb_params.price_handler)||t.closest(yith_wcpb_params.price_handler_parent_alt).find(yith_wcpb_params.price_handler_alt),c=1==yith_wcpb_params.price_handler_only_first?e.not(i).first():e.not(i),a=t.closest("form").find("button[type=submit]"),n=t.closest(".product").find(".add-request-quote-button"),s=t.find(".bundled_item_cart_content"),p=t.find("input.yith-wcpb-bundled-quantity"),u=t.find(".yith-wcpb-bundled-optional"),h=t.find(".variation_id"),f=t.find("input[name=yith_wcpb_wpml_client_currency]"),m=null,g={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0},o=function(t){y(this).is(".disabled")&&(t.preventDefault(),y(this).is(".yith-wcpb-out-of-stock-item-selected")?window.alert(yith_wcpb_params.i18n.out_of_stock_item_selected):y(this).is(".yith-wcpb-variation-selection-needed")&&window.alert(yith_wcpb_params.i18n.variation_selection_needed))};a.on("click",o),n.on("click",o),t.on("yith_wcpb_update_price",function(){var o,_,l,t,i;l=_=o=!1,i=[t="disabled","yith-wcpb-variation-selection-needed","yith-wcpb-out-of-stock-item-selected"].join(" "),s.each(function(){var t=y(this),i=t.closest(".yith-wcpb-product-bundled-item"),e=i.find(".yith-wcpb-bundled-optional").first(),a=i.find(".yith-wcpb-bundled-quantity").first(),n=t.find("select.yith-wcpb-select-for-variables"),r=e.length,d=r&&e.is(":checked"),c=a.length&&0===parseInt(a.val());r&&!d||c?r&&(t.find(".quantity input.qty").removeAttr("max"),t.find(".single_variation_wrap").slideUp("fast"),t.find(".variations").slideUp("fast")):(n.each(function(){y(this).val()||(_=o=!0)}),t.find(".variations").slideDown("fast"),t.find(".single_variation_wrap").slideDown("fast"),t.find(".out-of-stock").length&&(l=o=!0))}),_&&(t+=" yith-wcpb-variation-selection-needed"),l&&(t+=" yith-wcpb-out-of-stock-item-selected"),p.filter(function(){return!this.checkValidity()}).length&&(o=!0),o?a.addClass(t):a.removeClass(i),n.length&&(o?n.addClass(t):n.removeClass(i)),function(){if(m&&m.abort(),1==d){c.block(g);var t=[],i=[],e=[];p.each(function(){t[y(this).data("item-id")-1]=y(this).val()}),u.each(function(){i[y(this).data("item-id")-1]=y(this).is(":checked")?1:0}),h.each(function(){e[y(this).data("item-id")-1]=y(this).val()});var a=0<f.length?f.val():"",n={bundle_id:r,array_qty:t,array_opt:i,array_var:e,yith_wcpb_wpml_client_currency:a,action:"yith_wcpb_get_bundle_total_price"};m=y.ajax({type:"POST",data:n,url:ajax_obj.ajaxurl,success:function(t){var i=c.find("ins .amount");i.length<1&&(i=c.find(".amount")),i.length<1&&(i=c),(i=i.first()).html(t.price_html),c.html(t.price_html),y(document).trigger("yith_wcpb_ajax_update_price_request",t),c.unblock()}})}}()}),"yes"===yith_wcpb_params.update_price_on_load&&t.trigger("yith_wcpb_update_price"),p.on("change",function(){y(this).parents(".bundled_item_cart_content").length||t.trigger("yith_wcpb_update_price")}),u.on("click",function(){y(this).parents(".bundled_item_cart_content").length||t.trigger("yith_wcpb_update_price")}),s.on("change",function(){t.trigger("yith_wcpb_update_price")}),s.on("found_variation",function(t,i){var e=y(this).closest(".product"),a=e.find(".yith-wcpb-product-bundled-item-data__price .price").first(),n=a.find("ins"),r=a.find("del"),d=e.find(".yith-wcpb-product-bundled-item-image img").first(),c=e.data("min-quantity"),o=e.data("max-quantity"),_=e.find(".yith-wcpb-bundled-quantity");if("undefined"!=typeof i.max_qty&&i.max_qty&&(o=Math.min(o,i.max_qty)),_.length){_.attr("min",c),e.find(".yith-wcpb-bundled-quantity__invalid-notice__min-qty").html(c),_.attr("max",o),e.find(".yith-wcpb-bundled-quantity__invalid-notice__max-qty").html(o);var l=Math.min(Math.max(_.val(),c),o);_.val(l)}"undefined"!=typeof i.image&&("undefined"!=typeof i.image.srcset&&i.image.srcset?d.attr("srcset",i.image.srcset):"undefined"!=typeof i.image.thumb_src&&i.image.thumb_src&&(d.removeAttr("srcset"),d.attr("src",i.image.thumb_src)),"undefined"!=typeof i.image.full_src&&"undefined"!=typeof i.image.full_src_h&&"undefined"!=typeof i.image.full_src_w&&(d.attr("data-large_image",i.image.full_src),d.attr("data-large_image_width",i.image.full_src_w),d.attr("data-large_image_height",i.image.full_src_h))),n.html(i.price_html.replace("price","amount")),r.html(i.display_regular_price_html),y(document).trigger("yith_wcpb_found_variation_after",[y(this),i])}).on("reset_data",function(){var t=y(this).closest(".product"),i=t.find(".yith-wcpb-product-bundled-item-data__price .price").first(),e=i.find("ins"),a=i.data("default-ins"),n=i.find("del"),r=i.data("default-del"),d=t.find(".yith-wcpb-product-bundled-item-image img").first(),c=d.attr("src");void 0!==c&&0<c.length&&d.attr("srcset",c),e.html(a),n.html(r)}),s.trigger("check_variations"),s.trigger("update_variation_values")})},y(document).on("yith_wcpb_add_to_cart_init",function(){y(".yith-wcpb-bundle-form").yith_bundle_form()}).trigger("yith_wcpb_add_to_cart_init"),y(document).on("qv_loader_stop",function(){y(document).trigger("yith_wcpb_add_to_cart_init")}),y(document).on("mfpOpen",function(){y(".variations_form").each(function(){y(this).wc_variation_form()}),y(document).trigger("yith_wcpb_add_to_cart_init")});var r={enabled:"undefined"!=typeof PhotoSwipe&&"undefined"!=typeof PhotoSwipeUI_Default&&"undefined"!=typeof wc_single_product_params&&"yes"===yith_wcpb_params.photoswipe_enabled,init:function(){y(document).on("click",".yith-wcpb-product-bundled-item-image .woocommerce-product-gallery__image a",this.openPhotoswipe),this.indexGallery()},getImages:function(){return y(".yith-wcpb-product-bundled-item-image .woocommerce-product-gallery__image")},indexGallery:function(){var t=this.getImages(),i=0;t.each(function(){y(this).data("bundled-image-index",i),i++})},getGalleryItems:function(){var t=this.getImages(),n=[];return 0<t.length&&t.each(function(t,i){var e=y(i).find("img");if(e.length){var a={src:e.attr("data-large_image"),w:e.attr("data-large_image_width"),h:e.attr("data-large_image_height"),title:e.attr("data-caption")?e.attr("data-caption"):e.attr("title")};n.push(a)}}),n},openPhotoswipe:function(t){if(t.preventDefault(),r.enabled){var i=y(".pswp")[0],e=r.getGalleryItems(),a=y(t.target).closest(".woocommerce-product-gallery__image"),n=y.extend({index:y(a).data("bundled-image-index")},wc_single_product_params.photoswipe_options);new PhotoSwipe(i,PhotoSwipeUI_Default,e,n).init()}}};r.init()});