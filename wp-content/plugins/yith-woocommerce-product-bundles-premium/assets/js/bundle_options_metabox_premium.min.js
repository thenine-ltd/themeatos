jQuery(function(c){"use strict";var d=c("#_yith_wcpb_per_item_pricing"),n=c("#_yith_wcpb_non_bundled_shipping"),t=c("select#product-type"),e=c("#_ywcnp_enabled_product"),o=c("#_yith_wcpb_bundle_regular_price"),a=c("#_yith_wcpb_bundle_sale_price"),i=c("#_yith_wcpb_show_saving_amount"),s=o.closest(".yith-wcpb-form-field"),l=a.closest(".yith-wcpb-form-field"),_=i.closest(".yith-wcpb-form-field"),r=woocommerce_admin_meta_boxes.post_id,h={message:null,overlayCSS:{background:"#fff",opacity:.7}},u=function(){return"yith_bundle"===t.val()},p={target:".yith-wcpb-show-conditional:not(.yith-wcpb-show-conditional--initialized)",initEvent:"yith-wcpb-show-conditional-init",init:function(){c(p.target).hide().each(function(){var t,e=c(this),i=e.data("dep-selector"),d=c(i).first(),n=e.data("dep-value");d.length&&((t=d.is("input[type=checkbox]"))&&(n="no"!==n),d.on("change keyup",function(){(t?d.is(":checked"):d.val())===n?e.show():e.hide()}).trigger("change"))})}};c(document).on(p.initEvent,p.init),p.init();var b={el:{root:c("#yith_bundle_product_data"),add_item_btn:c("#yith-wcpb-add-bundled-product"),bundled_items:c("#yith_bundle_product_data .yith-wcpb-bundled-items"),items_count:c("#yith_bundle_product_data .yith-wcpb-bundled-items .yith-wcpb-bundled-item").size()+1,ajax_filter_products:null,expandCollapse:c("#yith-wcpb-bundled-items-expand-collapse"),actions:c("#yith-wcpb-bundled-items__actions")},init:function(){this.el.add_item_btn.on("click",this.select_products),c(document).on("click",".yith-wcpb-add-product",this.add_item),c(document).on("keyup","input.yith-wcpb-select-product-box__filter__search",this.search_filter),c(document).on("click",".yith-wcpb-remove-bundled-product-item",this.remove_current_item),c(document).on("click",".yith-wcpb-bundled-item h3 a",this.stop_event_propagation),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .first:not(.disabled)",this.paginate),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .prev:not(.disabled)",this.paginate),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .next:not(.disabled)",this.paginate),c(document).on("click",".yith-wcpb-select-product-box__products__pagination .last:not(.disabled)",this.paginate),this.sorting(),this.bundledItemsChangeHandler()},add_item:function(){var e=c(this).data("id"),t=c(this).closest(".yith-wcpb-select-product-box__products");if(e){t.block(h);var i={action:"yith_wcpb_add_product_in_bundle",open_closed:"open",bundle_id:r,id:b.el.items_count,product_id:e};c.ajax({type:"POST",url:ajaxurl,data:i,success:function(t){t.error?alert(t.error):t.html&&(b.el.bundled_items.append(t.html),c(document.body).trigger("wc-enhanced-select-init"),c(document.body).trigger("yith-plugin-fw-init-radio"),c(document).trigger("yith-wcpb-show-conditional-init"),b.el.items_count++,b.addItemToItemsWithQty(e),b.bundledItemsChangeHandler())},complete:function(){t.unblock()}})}},remove_current_item:function(){var t=c(this).closest(".yith-wcpb-bundled-item"),e=t.data("product-id");t.remove(),b.removeItemToItemsWithQty(e),b.bundledItemsChangeHandler()},filter_products:function(t){t.s!==undefined&&t.s.length<yith_bundle_opts.minimum_characters&&(t.s=""),t=c.extend(t,{action:"yith_wcpb_select_product_box_filtered"});var i=c(".yith-wcpb-select-product-box__products");i.block(h),b.el.ajax_filter_products&&b.el.ajax_filter_products.abort(),b.el.ajax_filter_products=c.ajax({type:"POST",url:ajaxurl,data:t,success:function(t){i.html(t),b.updateAddedQuantities()},complete:function(t,e){"abort"!==e&&i.unblock(h)}})},paginate:function(){var t=c(this).data("page");if(t!==undefined){var e=c("input.yith-wcpb-select-product-box__filter__search").val();b.filter_products({s:e,page:t})}},search_filter:function(){var t=c(this).val();(!t||t.length>=yith_bundle_opts.minimum_characters)&&b.filter_products({s:t})},select_products:function(){c.fn.yith_wcpb_popup({ajax:!0,url:ajaxurl,ajax_data:{action:"yith_wcpb_select_product_box"},ajax_success:function(){c(".yith-wcpb-select-product-box__filter__search").focus(),b.updateAddedQuantities()}})},sorting:function(){var t=this.el.bundled_items.find(".yith-wcpb-bundled-item").get();t.sort(function(t,e){var i=parseInt(c(t).attr("rel")),d=parseInt(c(e).attr("rel"));return i<d?-1:d<i?1:0}),c(t).each(function(t,e){b.el.bundled_items.append(e)}),this.el.bundled_items.sortable({items:".yith-wcpb-bundled-item",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")}})},stop_event_propagation:function(t){t.stopPropagation()},bundledItemsChangeHandler:function(){b.el.bundled_items.find(".yith-wcpb-bundled-item").length?(b.el.expandCollapse.show(),b.el.actions.removeClass("yith-wcpb-bundled-items__actions--hero")):(b.el.expandCollapse.hide(),b.el.actions.addClass("yith-wcpb-bundled-items__actions--hero")),b.updateAddedQuantities()},getItemsWithQty:function(){return b.el.root.data("items-with-qty")},setItemsWithQty:function(t){b.el.root.data("items-with-qty",t)},addItemToItemsWithQty:function(t){var e=b.getItemsWithQty();e[t]?e[t]++:e[t]=1,b.setItemsWithQty(e)},removeItemToItemsWithQty:function(t){var e=b.getItemsWithQty();e[t]?(e[t]--,e[t]||delete e[t]):e[t]=1,b.setItemsWithQty(e)},updateAddedQuantities:function(){var t=c(".yith-wcpb-select-product-box__products .yith-wcpb-select-product-box__product"),a=b.getItemsWithQty();t.each(function(t,e){var i=(e=c(e)).data("product-id"),d=a[i],n=e.find(".yith-wcpb-product-added"),o=n.find(".yith-wcpb-product-added__text");1===d?(o.html(yith_bundle_opts.i18n.addedLabelSingular),n.show()):1<d?(o.html(yith_bundle_opts.i18n.addedLabelPlural.replace("%s",d)),n.show()):n.hide()})}};b.init(),c(".pricing").addClass("hide_if_yith_bundle"),c("._manage_stock_field").addClass("show_if_yith_bundle"),c("._tax_status_field").closest("div").addClass("show_if_yith_bundle"),c("._sold_individually_field").addClass("show_if_yith_bundle").closest("div").addClass("show_if_yith_bundle"),c(".shipping_tab").addClass("yith_bundle_hide_if_non_bundled_shipping").addClass("yith_bundle_show_if_bundled_shipping"),d.on("change",function(){u()&&("yes"===c(this).val()?(o.val(""),a.val(""),s.hide(),l.hide(),_.hide(),e.length&&e.parent().hide()):(s.show(),l.show(),_.show(),e.length&&e.change().parent().show()))}).trigger("change"),n.on("change",function(){u()&&("yes"===c(this).val()?c(".yith_bundle_hide_if_non_bundled_shipping").hide():c(".yith_bundle_show_if_bundled_shipping").show())}).trigger("change"),c("body").on("woocommerce-product-type-change",function(t,e,i){"yith_bundle"===e?(o.removeAttr("disabled"),a.removeAttr("disabled"),c("input#_downloadable").prop("checked",!1),c("input#_virtual").removeAttr("checked"),d.change(),n.change()):(o.attr("disabled","disabled"),a.attr("disabled","disabled"))}),t.change();var m={dom:{handler:c("#yith-wcpb-limit-product-selection"),fields:c("#_yith_wcpb_bundle_advanced_options_min, #_yith_wcpb_bundle_advanced_options_max, #_yith_wcpb_bundle_advanced_options_min_distinct, #_yith_wcpb_bundle_advanced_options_max_distinct"),fieldWrappers:!1},init:function(){var t=this;t.dom.fieldWrappers=t.dom.fields.closest(".yith-wcpb-form-field"),t.dom.handler.on("change",t.handleToggle),t.storeFieldValues(),t.handleVisibility()},storeFieldValues:function(){m.dom.fields.each(function(){c(this).data("prev-value",c(this).val())})},setFieldValues:function(t){m.dom.fields.each(function(){"prev"!==t?c(this).val(t):c(this).val(c(this).data("prev-value"))})},handleToggle:function(){"yes"===m.dom.handler.val()?m.setFieldValues("prev"):(m.storeFieldValues(),m.setFieldValues(0)),m.handleVisibility()},handleVisibility:function(){"yes"===m.dom.handler.val()?m.dom.fieldWrappers.show():m.dom.fieldWrappers.hide()}};m.init(),c(document).on("yith-wcpb-show-conditional-init",function(){c(".yith-wcpb-show-conditional").hide().each(function(){var t,e=c(this),i=e.data("field-id"),d=c("#"+i),n=e.data("value");d.length&&((t=d.is("input[type=checkbox]"))&&(n="no"!==n),d.is(".yith-wcbk-printer-field__on-off")&&(d=d.find("input")),d.on("change keyup",function(){(t?d.is(":checked"):d.val())===n?e.show():e.hide()}).trigger("change"))})})});