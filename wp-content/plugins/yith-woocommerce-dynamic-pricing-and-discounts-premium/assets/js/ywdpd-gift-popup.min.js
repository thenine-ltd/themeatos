jQuery(function(s){var a=s(document).find(".ywdpd_popup"),p={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0},e={},_={},i={};init_global_var=function(){a.find(".ywdpd_single_rule_container").each(function(){var t=s(this).attr("id"),d=s(this).data("allowed_items");e[t]||(e[t]=parseInt(d)),_[t]||(_[t]=[]),i[t]||(i[t]=[])})},get_allowed_item_by_rule=function(t){var d=0;return-1===(t=""+t).indexOf("ywdpd_single_rule_")&&(t="ywdpd_single_rule_"+t),e[t]&&(d=e[t]),d},get_qty_added=function(t,d){var e=!1,i=0,e=s(t).find("li.product.item .ywdpd_qty");return void 0===d&&(d=""),e.each(function(){var t=s(this);""!=d&&d==t.attr("id")||(t=""===(t=t.html())?0:parseInt(t),i+=t)}),i},add_product_in_list=function(t,d,e,i){-1===(t=""+t).indexOf("ywdpd_single_rule_")&&(t="ywdpd_single_rule_"+t),void 0===e&&(e=""),void 0===i&&(i={});var n=function(t){for(var d=0,e=t.length;0<e;)d=(d<<5)-d+t.charCodeAt(--e)|0;return d}(n=d+"_"+e+"_"+JSON.stringify(i));return-1===found_index_product_in_list(t,n)&&(i={key:n,product_id:d,variation_id:e,variations:i,quantity:1},_[t].push(i)),n},remove_product_in_list=function(t,d){-1===(t=""+t).indexOf("ywdpd_single_rule_")&&(t="ywdpd_single_rule_"+t);d=found_index_product_in_list(t,d);0<=d&&_[t].splice(d,1)},increase_quantity_in_product_list=function(t,d){-1===(t=""+t).indexOf("ywdpd_single_rule_")&&(t="ywdpd_single_rule_"+t);var e=found_index_product_in_list(t,d);0<=e&&((d=_[t][e]).quantity=d.quantity+1,_[t][e]=d)},found_index_product_in_list=function(t,e){var i=-1;return-1===(t=""+t).indexOf("ywdpd_single_rule_")&&(t="ywdpd_single_rule_"+t),_[t]&&(t=_[t],s.each(t,function(t,d){if(d.key==e)return i=t,!1})),i},decrease_quantity_in_product_list=function(t,d){-1===(t=""+t).indexOf("ywdpd_single_rule_")&&(t="ywdpd_single_rule_"+t);var e=found_index_product_in_list(t,d);0<=e&&((d=_[t][e]).quantity=d.quantity-1,_[t][e]=d)},show_confirm_button=function(t){var d=a.find(".ywdpd_single_rule_container").length,e=a.find(".ywdpd_btn_container");1<get_allowed_item_by_rule(t)||1<d?e.length&&e.show():e.find("a").click()},init_component=function(){init_qty_field(),a.on("click",".ywdpd_btn_container a",function(t){var d=s(this).parents(".ywdpd_step1");rule_to_apply=d.find(".ywdpd_single_rule_container"),count=0,tot_rule=rule_to_apply.length,s(".ywdpd_popup_stage").block(p),rule_to_apply.each(function(){count++,ajax_action=s(this).hasClass("gift_products")?ywdpd_popup_args.actions.add_gift_to_cart:ywdpd_popup_args.actions.add_special_to_cart,data={rules_to_apply:_,action:ajax_action},s.ajax({type:"POST",url:ywdpd_popup_args.ajax_url,data:data,dataType:"json",success:function(t){count==tot_rule&&setTimeout(function(){"undefined"!=typeof t.fragments&&s(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash])},1e3)},complete:function(){count==tot_rule&&(s(".ywdpd_popup_stage").unblock(),close_popup())}})})})},init_popup=function(){init_global_var(),init_slider(),init_component()},show_popup=function(){init_popup(),setTimeout(function(){a.fadeIn(300),center()},900)},close_popup=function(){a.fadeOut(300),a.hasClass("cart")&&s(document).trigger("wc_update_cart")},update_counter=function(t){var d=s(document).find("#ywdpd_single_rule_"+t),e=get_allowed_item_by_rule(t),t=get_qty_added(d);remain=e-t,0==remain?(d.find(".ywdpd_qty_increase.button").addClass("disabled"),d.find(".single_add_to_cart_button.button").addClass("disabled")):(d.find(".ywdpd_qty_increase.button").removeClass("disabled"),d.find(".single_add_to_cart_button.button").removeClass("disabled"))},init_slider=function(){a.find(".ywdpd_popup_stage").each(function(){var t=s(this).find(".owl-carousel"),d=parseInt(t.find("li").size()),e=30,i=!1,n=!0;1==(d=3<d?3:d)&&(n=!(i=!(e=0)));var _=s(this).find("ul.ywdpd_popup_items");3<=d&&_.css({"padding-left":"5px"}),2==d&&_.css({"padding-left":"30px"}),t.owlCarousel({loop:!1,margin:e,center:i,autoWidth:!0,nav:n,navText:["<span></span>","<span></span>"],responsiveClass:!0,onInitialized:function(t){1<t.item.count&&_.find(".owl-stage").css({margin:"0 auto"})},responsive:{0:{items:1,autoWidth:!1,margin:10},721:{items:d},1e3:{items:d}}})})},init_qty_field=function(){s(document).find(".ywdpd_qty_arrows, .single_add_to_cart_button").on("touchstart mousedown",function(t){t.stopImmediatePropagation()}),s(document).on("click",".ywdpd_qty_remove.button",function(t){t.preventDefault(),t.stopImmediatePropagation();var d=s(this).closest(".ywdpd_qty_input").find(".ywdpd_qty"),t=s(this).parents(".ywdpd_qty_fields_container").parent().find(".single_add_to_cart_button");rule_container=s(this).closest(".ywdpd_single_rule_container"),li=d.closest("li.product.item"),rule_id=li.data("ywdpd_rule_id"),key=d.attr("id"),remove_product_in_list(rule_id,key),t.hasClass("variable")?(d.parent().parent().remove(),s(this).parents(".ywdpd_qty_fields_container").find(".ywdpd_qty_field").length||li.removeClass("added")):(d.attr("id",""),d.html(""),d.parent().parent().hide(),li.removeClass("added"),t.show()),update_counter(rule_id)}),s(document).on("click",".ywdpd_qty_decrease.button",function(t){t.preventDefault(),t.stopImmediatePropagation();var d=s(this).closest(".ywdpd_qty_input").find(".ywdpd_qty"),e=s(this).closest(".ywdpd_single_rule_container"),i=d.closest("li.product.item"),n=i.data("ywdpd_rule_id"),_=i.data("product_id"),t=parseInt(d.html())-1;1<=t&&(d.html(t),s(document).trigger("ywdpd_product_qty_decreased",[s(this),i,n,_,d])),1==t?(s(this).addClass("disabled").hide(),s(this).closest(".ywdpd_qty_input").find(".ywdpd_qty_remove").css({display:"inline-block"})):s(this).removeClass("disabled"),get_qty_added(e)<get_allowed_item_by_rule(n)&&(s(".ywdpd_qty_input .ywdpd_qty_increase").removeClass("disabled"),s(e).find(".single_add_to_cart_button").removeClass("disabled"))}),s(document).on("click",".ywdpd_qty_increase.button",function(t){t.preventDefault(),t.stopImmediatePropagation();var d=s(this).closest(".ywdpd_qty_input").find(".ywdpd_qty"),e=s(this).closest(".ywdpd_single_rule_container"),i=d.closest("li.product.item"),n=i.data("ywdpd_rule_id"),_=i.data("product_id"),a=parseInt(get_allowed_item_by_rule(n)),t=""===(t=d.html())?0:parseInt(t);new_value=t+1,max=get_qty_added(e,d.attr("id")),max=a-max,new_value<=max&&(d.html(new_value),s(document).trigger("ywdpd_product_qty_increased",[s(this),i,n,_,d])),new_value==max?(s(".ywdpd_qty_input .ywdpd_qty_increase").addClass("disabled"),s(this).closest(".ywdpd_qty_input").find(".ywdpd_qty_decrease").removeClass("disabled"),s(e).find(".single_add_to_cart_button").addClass("disabled")):s(".ywdpd_qty_input .ywdpd_qty_increase").removeClass("disabled"),1<new_value&&(s(this).closest(".ywdpd_qty_input").find(".ywdpd_qty_decrease").css({display:"inline-block"}),s(this).closest(".ywdpd_qty_input").find(".ywdpd_qty_remove").hide())})},back_to_step1=function(){a.find(".ywdpd_step2").fadeOut(300,function(){a.find(".ywdpd_step1").fadeIn(300),a.find(".ywdpd_step2").html("")})},go_to_step2=function(t){a.find(".ywdpd_step1").fadeOut(300,function(){a.find(".ywdpd_step2").html(t),a.find(".ywdpd_step2 .variations_form").each(function(){s(this).wc_variation_form()}),d(),n(),add_variable_gift(),a.find(".ywdpd_step2").fadeIn(300),s(document).trigger("ywdpd_step2_initialized")})},center=function(){var t=a.find(".ywdpd_popup_wrapper"),d=t.find(".ywdpd_single_rule_container"),e=t.css("width"),i=t.outerHeight(),n=s(".ywdpd_popup").width(),_=s(".ywdpd_popup").height();720<s(window).width()?d.each(function(){var t=s(this).find("ul li").length;e=3<=t?715:438}):(e=e.replace("px",""),e=parseFloat(e),i=parseFloat(i)-10,s("#wpadminbar").length&&(i-=s("#wpadminbar").height())),t.css({position:"fixed",top:(_-i)/2+"px",left:(n-e)/2+"px"})},show_qty_field=function(t){s(t).find(".single_add_to_cart_button.button").hide(),s(t).find(".ywdpd_qty_field").show()},a.on("click",".ywdpd_close",close_popup),a.on("click",".ywdpd_step1 ul.ywdpd_popup_items li.product .single_add_to_cart_button",function(t){t.preventDefault();var d=s(this).closest("li.product.item"),e=d.data("product_id"),i=d.data("ywdpd_rule_id"),n=(d.data("product_type"),get_allowed_item_by_rule(i));s(this).hasClass("variable")?(t=s(this).data("ywdpd_action"),t={product_id:e,rule_id:i,action:ywdpd_popup_args.actions.show_second_step,rule_type:t},s.ajax({type:"POST",url:ywdpd_popup_args.ajax_url,data:t,dataType:"json",beforeSend:function(){d.parents(".ywdpd_single_rule_container").block(p)},success:function(t){""!==t.template&&go_to_step2(t.template)},complete:function(){d.parents(".ywdpd_single_rule_container").unblock()}})):s(document).trigger("ywdpd_first_product_added",[d,i,e,n])});var d=function(){s(".variations_form.cart").on("found_variation",function(t,d){var e=s(this),i=s(this).parent().find(".ywdpd_rule_id").val(),n=s("#ywdpd_single_rule_"+i),_=s('input[name="product_id"]').val(),a=n.find("li.item[data-product_id='"+_+"']"),o=s("input.ywdpd_rule_type").val(),n=a.data("discount_type"),_=a.data("discount_amount"),a=a.data("total_to_add"),a={ywdp_check_rule_id:i,product_id:d.variation_id,rule_type:o,type_discount:n,amount_discount:_,tot_to_add:a,action:ywdpd_popup_args.actions.check_variable};s.ajax({type:"POST",url:ywdpd_popup_args.ajax_url,data:a,dataType:"json",beforeSend:function(){e.block(p)},success:function(t){t.variation_found?s(".ywdpd_add_to_gift").addClass("disabled"):d.is_in_stock?(s(".ywdpd_add_to_gift").removeClass("disabled"),s(".ywdpdp_single_product p.stock.out-of-stock").remove()):(s(".ywdpdp_single_product .variations_form.cart").append(d.availability_html),s(".ywdpd_add_to_gift").addClass("disabled")),s(".ywdpd_step2 .price").html(t.price),s(".ywdpd_step2 .price").show()},complete:function(){e.unblock()}})}).on("reset_data",function(t){s(".ywdpd_add_to_gift").addClass("disabled"),s(".ywdpdp_single_product p.stock.out-of-stock").remove(),s(".ywdpd_step2 .price").hide()}),s(".ywdpd_step2").on("select2:open",function(t){s(".select2-container").addClass("ywcdd_select2")}),s(".ywdpd_step2").on("select2:closing",function(t){s(".select2-container").removeClass("ywcdd_select2")})},n=function(){var d=s(".ywdpd_step2 .ywdpdp_single_product");d.length&&d.hasClass("variation")&&(d.find("select").select2(),d.on("click",".reset_variations",function(t){d.find("select").val("").trigger("change")}),o(d),d.on("change","select",function(t){o(d)}))},o=function(t){var d=t.find(".ywdpd_add_to_gift"),e=!0;d.addClass("disabled"),t.find("select").each(function(){""===s(this).val()&&(e=!1)}),e&&d.removeClass("disabled")};add_variable_gift=function(){s(document).on("click",".ywdpd_add_to_gift",function(t){t.preventDefault(),t.stopImmediatePropagation();var e,d=s('input[name="product_id"]').val(),i=s("input.variation_id").val(),t=(n=(n=s(this)).closest(".ywdpd_single_product_right").find('[name^="attribute"]'),e={},n.each(function(){var t=s(this),d=t.attr("name");e[d]=t.val()}),e),n="";rule_id=s("input.ywdpd_rule_id").val(),n=s(document).find("#ywdpd_single_rule_"+rule_id),li="",li=s(this).parent().parent().parent().hasClass("variation")?n.find('ul.ywdpd_popup_items li[data-product_id="'+i+'"]'):n.find('ul.ywdpd_popup_items li[data-product_id="'+d+'"]');var _,a,n=add_product_in_list(rule_id,d,i,t);qty_field=li.find("#"+n+".ywdpd_qty"),qty_field.length?qty_field.parent().find(".ywdpd_qty_increase.button").click():(d='<div class="ywdpd_qty_field">',d+='<div class="ywdpd_qty_input">',d+='<span class="ywdpd_qty_label">'+ywdpd_popup_args.i18n_qty_field_label+"</span>",d+='<div class="ywdpd_attribute_fields"></div>',d+='<span class="ywdpd_qty"></span>',d+='<span class="ywdpd_qty_arrows">',d+='<span class="ywdpd_qty_remove button"><span></span></span>',d+='<span class="ywdpd_qty_decrease button"><span></span></span>',d+='<span class="ywdpd_qty_increase button"><span></span></span>',d+="</span>",d+="</div>",i=s(d+="</div>"),d=t,t=s(this),_="",a=t.closest(".ywdpd_single_product_right"),s.each(d,function(t,d){let e=a.find('[name ="'+t+'"]'),i=a.find('label[for="'+e.attr("id")+'"]');_+='<div class="ywdpd_single_attribute">',_+="<span class='attribute_name'>"+i.html()+":</span>",_+="<span class='attribute_value'>"+d+"</span>",_+="</div>"}),d=_,i.find(".ywdpd_qty").attr("id",n),i.find(".ywdpd_qty").html(1),i.find(".ywdpd_attribute_fields").html(d),i.appendTo(li.find(".ywdpd_qty_fields_container")).show(),li.addClass("added"),init_qty_field()),show_confirm_button(rule_id),update_counter(rule_id),back_to_step1()})},s(document).on("click",".ywdpd_back",function(t){back_to_step1()}),s(document).on("click",".ywdpd_footer a",function(t){t.preventDefault(),close_popup()}),s(document).on("keyup",function(t){27==t.keyCode&&close_popup()}),s(document).on("ywdpd_first_product_added",function(t,d,e,i,n){var _=add_product_in_list(e,i),i=a.find(".ywdpd_single_rule_container").length;d.find(".ywdpd_qty").attr("id",_),d.find(".ywdpd_qty").html(1),update_counter(e),d.addClass("added"),1<n||1<i?(show_qty_field(d),show_confirm_button(e)):s(".ywdpd_btn_container a").click()}),s(document).on("ywdpd_product_qty_increased",function(t,d,e,i,n,_){increase_quantity_in_product_list(i,_.attr("id")),update_counter(i)}),s(document).on("ywdpd_product_qty_decreased",function(t,d,e,i,n,_){decrease_quantity_in_product_list(i,_.attr("id")),update_counter(i)}),a.length&&(s(window).on("resize",function(){center()}),show_popup())});